# Durdle Platform - Master Product Backlog

**Document Owner:** CTO & CPO (Collaborative)
**Last Updated:** Current Sprint
**Status:** Active Development Backlog

---

## Backlog Organization

**Priority Tiers:**
- **P0 (BLOCKING)** - Must complete before Phase 3 launch, system broken without it
- **P1 (CRITICAL)** - Required for Phase 3 MVP (revenue generation)
- **P2 (HIGH)** - Important for Phase 3 success, but can launch without
- **P3 (MEDIUM)** - Nice to have, deferred to Phase 4
- **P4 (LOW)** - Future consideration

**Effort Sizing:**
- **XS** - 1-2 days
- **S** - 3-5 days
- **M** - 1-2 weeks
- **L** - 3-4 weeks
- **XL** - 1-2 months

---

## ðŸš¨ IMMEDIATE PRIORITIES (Complete Before Phase 3)

### ADMIN-001: Admin Quote Management Dashboard
**Priority:** P0 (BLOCKING)
**Effort:** M (1-2 weeks)
**User Story:** As an admin, I need to see all quotes generated by customers so I can monitor interest, track conversion rates, and provide customer support.

**Acceptance Criteria:**
- [ ] Admin dashboard page at `/admin/quotes`
- [ ] Table displays: Quote ID, Created Date, Customer Email (if provided), Pickup Location, Dropoff Location, Price, Status (Active/Expired/Converted)
- [ ] Filter by: Status, Date Range, Price Range
- [ ] Search by: Quote ID, Location
- [ ] Sort by: Date (newest first default), Price
- [ ] Pagination: 50 quotes per page
- [ ] Click quote row to view full details (map, route, waypoints, pricing breakdown)
- [ ] Export to CSV button
- [ ] Real-time status updates (quote expiration, conversion to booking)
- [ ] Show "Converted to Booking" badge with booking reference link

**Technical Implementation:**
- Backend: New Lambda `quotes-manager` with DynamoDB queries on existing quotes table
- Frontend: New admin page with table component, filters, pagination
- API: `GET /api/admin/quotes?status={status}&limit=50&cursor={cursor}`

**Business Value:**
- Visibility into customer interest and demand patterns
- Identify abandoned quotes for follow-up campaigns
- Calculate quote-to-booking conversion rate
- Customer support can retrieve quotes by reference

---

### ADMIN-002: Quote Abandonment Tracking & Analytics
**Priority:** P0 (BLOCKING)
**Effort:** M (1-2 weeks)
**User Story:** As a CTO/CPO, I need to understand why customers abandon quotes so we can optimize the booking funnel and increase conversion.

**Acceptance Criteria:**
- [ ] Track quote funnel events: `quote_started`, `quote_calculated`, `quote_viewed`, `quote_shared`, `quote_expired`, `quote_converted`
- [ ] Store funnel events in DynamoDB with timestamps
- [ ] Admin analytics dashboard showing:
  - Total quotes generated (last 7/30/90 days)
  - Quote-to-booking conversion rate
  - Average time from quote to conversion
  - Abandonment rate by funnel stage
  - Common abandonment patterns (e.g., expires without viewing, views but doesn't book)
- [ ] Abandoned quote report: List of quotes that expired without conversion
- [ ] Optional: Email field on quote form (non-required) to enable follow-up
- [ ] CloudWatch custom metrics for quote funnel stages
- [ ] Quote abandonment alerts (e.g., if >80% abandon in 24hrs)

**Technical Implementation:**
- Backend: Event tracking Lambda, analytics aggregation Lambda
- DynamoDB: New `quote-events` table with GSI on event type and timestamp
- Frontend: New `/admin/analytics/quotes` dashboard with charts (Chart.js or Recharts)
- API: `GET /api/admin/analytics/quotes` returns aggregated funnel metrics

**Business Value:**
- Identify UX friction points in quote flow
- Calculate true marketing ROI (quote â†’ booking rate)
- Enable remarketing campaigns for abandoned quotes
- Data-driven pricing optimization

**Future Enhancements:**
- A/B test different quote expiry times
- SMS/email reminders for abandoned quotes (if contact details captured)
- Exit survey on quote page abandonment

---

### ADMIN-003: Quote-to-Booking Conversion View
**Priority:** P0 (BLOCKING)
**Effort:** S (3-5 days)
**User Story:** As an admin, when viewing a quote, I need to see if it converted to a booking so I can track conversion success.

**Acceptance Criteria:**
- [ ] Quote detail page shows "Booking Status" section
- [ ] If converted: Display booking reference number as clickable link to booking details
- [ ] If converted: Show conversion timestamp
- [ ] If not converted and expired: Show "Expired" badge with expiry timestamp
- [ ] If not converted and active: Show countdown timer "Expires in X minutes"
- [ ] Admin can manually extend quote expiry (+15 minutes button) for customer support cases

**Technical Implementation:**
- Backend: Add `bookingId` field to quotes table when booking created
- Backend: Add `PATCH /api/admin/quotes/:quoteId/extend` endpoint
- Frontend: Update quote detail page UI
- Validation: Only allow expiry extension if quote < 24 hours old

**Business Value:**
- Customer support can help customers who can't find their quote
- Track which quotes convert vs abandon
- Flexibility for edge cases (customer had payment issue, needs more time)

---

### INFRA-001: Production Environment Setup
**Priority:** P0 (BLOCKING)
**Effort:** M (1-2 weeks)
**User Story:** As a CTO, I need a separate production environment so dev testing doesn't affect live customer bookings.

**Acceptance Criteria:**
- [ ] Separate AWS account or isolated production VPC
- [ ] Production DynamoDB tables (durdle-*-prod)
- [ ] Production Lambda functions (durdle-*-prod)
- [ ] Production API Gateway stage
- [ ] Production S3 buckets with versioning enabled
- [ ] Production CloudWatch dashboards
- [ ] Production CloudWatch alarms (errors, latency, costs)
- [ ] Production secrets in AWS Secrets Manager
- [ ] Infrastructure-as-code using AWS CDK or Terraform (recommended)
- [ ] CI/CD pipeline: GitHub Actions â†’ Dev â†’ Staging â†’ Prod
- [ ] Rollback procedure documented
- [ ] Production deployment checklist

**Technical Implementation:**
- Copy dev infrastructure with `-prod` suffix
- Separate environment variables
- Stricter IAM policies (principle of least privilege)
- Enable AWS X-Ray tracing
- Point-in-time recovery enabled on all prod tables
- Multi-AZ deployment for critical services

**Business Value:**
- Zero risk of dev bugs affecting customers
- Confidence to test breaking changes in dev
- Professional deployment process for investor/client trust

---

### SECURITY-001: Production Security Hardening
**Priority:** P0 (BLOCKING)
**Effort:** M (1-2 weeks)
**User Story:** As a CTO, I need production-grade security before accepting customer payments.

**Acceptance Criteria:**
- [ ] API rate limiting (100 req/hr unauthenticated, 1000 req/hr authenticated)
- [ ] Admin MFA enabled (AWS Cognito or Auth0)
- [ ] Admin session timeout: 8 hours
- [ ] CORS properly configured (whitelist only production domains)
- [ ] Input validation on all API endpoints (Zod schemas)
- [ ] SQL injection protection (already using DynamoDB, but validate input)
- [ ] XSS protection headers (Content-Security-Policy)
- [ ] HTTPS enforced on all endpoints
- [ ] Secrets rotation policy (90 days for API keys)
- [ ] DDoS protection via AWS WAF or CloudFlare
- [ ] Security audit log: All admin actions logged to CloudWatch
- [ ] Penetration testing report (can use OWASP ZAP or hire external firm)

**Technical Implementation:**
- AWS WAF rules for rate limiting
- Add security headers in API Gateway responses
- Enable AWS GuardDuty for threat detection
- Configure AWS Config for compliance monitoring

**Business Value:**
- PCI DSS compliance readiness
- Customer trust and data protection
- Legal liability reduction
- Insurance requirements met

---

## ðŸ’° PHASE 3 FOUNDATION (Revenue Generation MVP)

### PAYMENT-001: Stripe Payment Integration
**Priority:** P1 (CRITICAL)
**Effort:** L (3-4 weeks)
**User Story:** As a customer, I need to pay securely for my booking so I can confirm my transport.

**Acceptance Criteria:**
- [ ] Stripe account setup (test mode + production mode)
- [ ] Stripe Payment Intents API integration
- [ ] Booking workflow: Quote â†’ Customer Details â†’ Payment â†’ Confirmation
- [ ] Payment form using Stripe Elements (PCI compliant)
- [ ] Accepts: Credit/debit cards, Apple Pay, Google Pay
- [ ] Payment success: Booking status â†’ "confirmed", charge customer
- [ ] Payment failure: Show error message, allow retry
- [ ] Idempotency: Prevent duplicate charges if customer clicks "Pay" multiple times
- [ ] Webhook handler for Stripe events: `payment_intent.succeeded`, `payment_intent.failed`
- [ ] Refund processing API (for cancellations)
- [ ] Test mode: Use Stripe test cards (4242 4242 4242 4242)

**Technical Implementation:**
- Backend: New Lambda `payment-processor` with Stripe SDK
- DynamoDB: New `payments` table (paymentId, bookingId, amount, status, stripePaymentIntentId)
- Frontend: Stripe Elements React component
- API: `POST /api/payments/intent` (create), `POST /api/payments/confirm` (confirm)
- Webhook: `POST /api/webhooks/stripe` (handle async events)

**Dependencies:**
- Stripe account approval (1-2 days)
- SSL certificate for production domain (if not using Vercel)

**Business Value:**
- **REVENUE GENERATION** - Core business model activation
- Professional payment experience
- Lower chargeback risk vs manual payments

---

### BOOKING-001: Customer Booking Workflow
**Priority:** P1 (CRITICAL)
**Effort:** L (3-4 weeks)
**User Story:** As a customer, I need to book a journey based on my quote so I can secure transport.

**Acceptance Criteria:**
- [ ] Booking form page at `/booking/new?quoteId={quoteId}`
- [ ] Form pre-filled with quote details (readonly)
- [ ] Customer details form: First Name, Last Name, Email, Phone (UK format)
- [ ] Phone validation: UK mobile numbers only
- [ ] Email validation: Standard email format
- [ ] Pickup instructions field (optional, 200 char max)
- [ ] Special requirements field (optional, wheelchair, child seat, luggage, 200 char max)
- [ ] Terms & Conditions checkbox (required, link to T&C page)
- [ ] "Proceed to Payment" button
- [ ] Form validation with clear error messages
- [ ] Booking created with status "pending_payment"
- [ ] Booking ID generated (format: DURDLE-{timestamp}-{random})
- [ ] Store booking in DynamoDB
- [ ] After payment success: Status â†’ "confirmed"
- [ ] Booking confirmation page with reference number

**Technical Implementation:**
- Backend: New Lambda `booking-manager` with DynamoDB writes
- DynamoDB: New `bookings` table (bookingId, quoteId, customerId, status, createdAt)
- Frontend: Multi-step booking form (React Hook Form + Zod validation)
- API: `POST /api/bookings` (create), `PATCH /api/bookings/:id` (update status)

**Business Value:**
- Converts quotes into revenue
- Captures customer contact details for communication
- Foundation for all future booking features

---

### NOTIFY-001: Booking Confirmation Emails
**Priority:** P1 (CRITICAL)
**Effort:** M (1-2 weeks)
**User Story:** As a customer, I need to receive booking confirmation via email so I have proof of purchase.

**Acceptance Criteria:**
- [ ] Email sent within 30 seconds of payment confirmation
- [ ] Email sent from `bookings@durdletransfers.co.uk` (or configured domain)
- [ ] Email subject: "Booking Confirmation - {bookingReference}"
- [ ] Email body includes:
  - Booking reference number
  - Customer name
  - Pickup location and time
  - Dropoff location
  - Vehicle type
  - Price paid
  - Cancellation policy (24-hour free cancellation)
  - Link to view/manage booking
  - Contact information (support email/phone)
- [ ] Email template branded with Durdle logo and colors
- [ ] Unsubscribe link in footer (GDPR compliance)
- [ ] Email delivery tracked (AWS SES metrics or SendGrid webhook)
- [ ] Fallback: If email fails, log error and retry once

**Technical Implementation:**
- Email service: AWS SES (cheap, reliable) or SendGrid (easier templates)
- Backend: New Lambda `notification-handler` triggered by booking status change
- DynamoDB: New `notifications` table (notificationId, bookingId, type, status, sentAt)
- Email template: Use MJML or React Email for responsive HTML

**Business Value:**
- Professional customer experience
- Reduces "I didn't receive confirmation" support tickets
- Legal proof of booking terms acceptance

---

### NOTIFY-002: Booking Confirmation SMS
**Priority:** P2 (HIGH)
**Effort:** S (3-5 days)
**User Story:** As a customer, I need to receive booking confirmation via SMS so I have quick mobile access.

**Acceptance Criteria:**
- [ ] SMS sent to customer phone within 30 seconds of payment
- [ ] SMS contains: Booking reference, pickup time, pickup location, price
- [ ] SMS includes link to view booking details
- [ ] Character limit: 160 chars (single SMS to reduce costs)
- [ ] SMS delivery status tracked
- [ ] Fallback: If SMS fails, log error but don't block booking

**Example SMS:**
```
DURDLE-12345 confirmed. Pickup: Bournemouth Station, Dec 10 at 14:30. Â£28 paid. View: durdle.link/b/abc123
```

**Technical Implementation:**
- SMS service: AWS SNS (UK numbers) or Twilio (more reliable, but pricier)
- Backend: Extend `notification-handler` Lambda
- Short URL service: Use AWS API Gateway short links or bit.ly API

**Business Value:**
- Instant confirmation for mobile-first customers
- Higher open rate than email (98% vs 20%)
- Critical for day-of-booking reminders

---

### BOOKING-002: View Booking Details (Customer)
**Priority:** P1 (CRITICAL)
**Effort:** M (1-2 weeks)
**User Story:** As a customer, I need to view my booking details online so I can check journey information.

**Acceptance Criteria:**
- [ ] Booking page at `/booking/{bookingId}` (secure link, no auth required)
- [ ] Display booking reference, status, pickup/dropoff, date/time, price
- [ ] Status badge: Pending, Confirmed, Assigned, In Progress, Completed, Cancelled
- [ ] If driver assigned: Show driver name, vehicle details (make, model, color, registration)
- [ ] Contact driver button (opens phone dialer) - only if driver assigned
- [ ] Cancel booking button (if >24 hours before pickup)
- [ ] Route map showing pickup and dropoff locations
- [ ] Booking timeline: Created â†’ Confirmed â†’ (Assigned) â†’ (Completed)
- [ ] Print booking button

**Technical Implementation:**
- Backend: Extend `booking-manager` Lambda with GET endpoint
- Frontend: New booking detail page with map integration
- API: `GET /api/bookings/:bookingId`
- Security: Use UUID for bookingId to prevent guessing

**Business Value:**
- Self-service customer portal reduces support load
- Transparency builds trust
- Easy sharing of booking details (link via email/SMS)

---

### BOOKING-003: Cancellation & Refund Processing
**Priority:** P1 (CRITICAL)
**Effort:** M (1-2 weeks)
**User Story:** As a customer, I need to cancel my booking if plans change and receive a refund.

**Acceptance Criteria:**
- [ ] Cancel button visible on booking page
- [ ] Cancellation policy displayed: "Free cancellation up to 24 hours before pickup"
- [ ] Confirmation modal: "Are you sure? This will refund Â£X to your card."
- [ ] If >24 hours: Full refund, booking status â†’ "cancelled"
- [ ] If <24 hours: Show warning "Cancellation fee applies (50% of total)"
- [ ] Refund processed via Stripe Refunds API
- [ ] Refund takes 5-7 business days to appear on card (display this message)
- [ ] Cancellation confirmation email sent
- [ ] If driver assigned: Driver notified via SMS/email
- [ ] Admin notified in dashboard (cancelled booking alert)

**Technical Implementation:**
- Backend: `DELETE /api/bookings/:bookingId` with policy validation
- Stripe API: Create refund with `reason: 'requested_by_customer'`
- Validation: Check pickup time vs current time, calculate fee
- DynamoDB: Update booking status, store cancellation reason and timestamp

**Business Value:**
- Builds customer confidence to book
- Legal compliance (consumer protection)
- Reduces disputes and chargebacks

---

### ADMIN-004: Admin Booking Management
**Priority:** P1 (CRITICAL)
**Effort:** L (3-4 weeks)
**User Story:** As an admin, I need to view and manage all bookings so I can provide customer support and dispatch drivers.

**Acceptance Criteria:**
- [ ] Admin bookings page at `/admin/bookings`
- [ ] Table columns: Reference, Status, Customer Name, Pickup Time, Pickup Location, Dropoff Location, Driver (if assigned), Price
- [ ] Filter by: Status (All, Confirmed, Assigned, In Progress, Completed, Cancelled)
- [ ] Filter by: Date range (Today, This Week, This Month, Custom)
- [ ] Search by: Booking reference, customer name, phone, email
- [ ] Sort by: Pickup time (default), created date, price
- [ ] Pagination: 50 bookings per page
- [ ] Click row to view full booking details
- [ ] "Assign Driver" button for confirmed bookings
- [ ] "Edit Booking" button (change time, location - Phase 2)
- [ ] "Cancel Booking" button with refund option
- [ ] "Send Notification" button (email/SMS customer)
- [ ] Export to CSV
- [ ] Real-time updates (new bookings appear automatically)

**Technical Implementation:**
- Backend: Extend `booking-manager` Lambda with admin queries
- Frontend: New admin table component with filters
- API: `GET /api/admin/bookings?status={status}&limit=50&cursor={cursor}`
- WebSocket or polling for real-time updates

**Business Value:**
- Central command center for operations
- Customer support can quickly find and help customers
- Foundation for dispatch workflow

---

## ðŸ“Š PHASE 3 ENHANCEMENTS (Important but can wait)

### ANALYTICS-001: Admin Analytics Dashboard
**Priority:** P2 (HIGH)
**Effort:** M (1-2 weeks)
**User Story:** As an admin, I need to see key metrics so I can monitor business performance.

**Acceptance Criteria:**
- [ ] Dashboard at `/admin/analytics`
- [ ] KPI cards: Total bookings today, revenue today, average booking value
- [ ] Bookings chart: Last 7/30/90 days (line chart)
- [ ] Revenue chart: Last 7/30/90 days (line chart)
- [ ] Conversion funnel: Quotes â†’ Bookings (percentage)
- [ ] Popular routes table: Top 10 routes by booking count
- [ ] Peak hours heatmap: Bookings by hour of day
- [ ] Driver utilization: Bookings per driver
- [ ] Cancellation rate: Percentage of bookings cancelled
- [ ] Date range selector
- [ ] Export report to PDF

**Technical Implementation:**
- Backend: New Lambda `analytics-aggregator` with DynamoDB scans
- DynamoDB: Consider creating analytics-optimized GSIs
- Frontend: Charts using Chart.js or Recharts
- API: `GET /api/admin/analytics?range=7d`
- Consider: Pre-aggregate daily metrics in separate DynamoDB table for performance

**Business Value:**
- Data-driven decision making
- Identify growth opportunities and bottlenecks
- Investor-ready metrics

---

### CUSTOMER-001: Customer Account Creation (Optional)
**Priority:** P2 (HIGH)
**Effort:** L (3-4 weeks)
**User Story:** As a frequent customer, I want to create an account so I can save my details and view booking history.

**Acceptance Criteria:**
- [ ] Sign up page with email and password
- [ ] Email verification required
- [ ] Profile page: View/edit name, email, phone
- [ ] Saved addresses: Add frequent pickup/dropoff locations
- [ ] Booking history: View all past and upcoming bookings
- [ ] Rebook button: Use same details from previous booking
- [ ] Delete account button (GDPR right to erasure)
- [ ] Password reset via email

**Technical Implementation:**
- Auth: AWS Cognito User Pools or Auth0
- DynamoDB: New `customers` table
- Frontend: Account pages with protected routes
- API: `POST /api/auth/signup`, `POST /api/auth/login`, `GET /api/customers/:id`

**Business Value:**
- Higher lifetime value from repeat customers
- Faster checkout for logged-in users
- Personalized marketing opportunities

---

### PRICING-001: Surge Pricing Management
**Priority:** P2 (HIGH)
**Effort:** M (1-2 weeks)
**User Story:** As an admin, I need to set surge pricing for high-demand periods so we can optimize revenue.

**Acceptance Criteria:**
- [ ] Surge pricing rules page at `/admin/pricing/surge`
- [ ] Create rule: Date/time range, multiplier (e.g., 1.5x)
- [ ] Rule types: Specific dates (Dec 24-25), Day of week (Fridays after 8pm), All weekends
- [ ] Active/inactive toggle for each rule
- [ ] Priority system if multiple rules overlap (highest multiplier wins)
- [ ] Preview quote with surge applied
- [ ] Surge pricing clearly shown to customers ("High demand period - 1.5x pricing")

**Technical Implementation:**
- Backend: `pricing-manager` Lambda with rule evaluation logic
- DynamoDB: New `pricing-rules` table
- Quote calculation: Check all active rules, apply highest multiplier
- Frontend: Admin UI for rule management

**Business Value:**
- Revenue optimization during peak demand
- Balance supply and demand
- Competitive with Uber/ride-hail pricing models

---

### PROMO-001: Promotional Codes & Discounts
**Priority:** P3 (MEDIUM)
**Effort:** M (1-2 weeks)
**User Story:** As an admin, I need to create promo codes for marketing campaigns.

**Acceptance Criteria:**
- [ ] Promo code management page at `/admin/promotions`
- [ ] Create promo code: Code (e.g., "LAUNCH20"), Discount type (percentage or fixed amount), Value, Expiry date, Usage limit
- [ ] Code validation on checkout: Check if expired, max uses reached, minimum booking value
- [ ] Display discount on quote summary
- [ ] Track promo code usage in analytics

**Technical Implementation:**
- DynamoDB: New `promo-codes` table
- API: `POST /api/promo/validate?code=LAUNCH20`
- Booking: Store promoCodeId with booking for tracking

**Business Value:**
- Customer acquisition tool
- Viral marketing (share codes on social media)
- Measurable campaign ROI

---

## ðŸš€ PHASE 4 PREPARATION (Future Strategic Work)

### DRIVER-001: Driver Mobile Portal (PWA)
**Priority:** P3 (MEDIUM)
**Effort:** XL (1-2 months)
**User Story:** As a driver, I need a mobile portal to view assigned jobs and update status.

**Acceptance Criteria:**
- [ ] Progressive Web App (installable on iOS/Android)
- [ ] Driver login with phone + PIN
- [ ] View assigned jobs (today + next 7 days)
- [ ] Job details: Customer name (first name only), phone, pickup/dropoff, route map
- [ ] Update job status: En Route â†’ Arrived â†’ Passenger Onboard â†’ Completed
- [ ] "Navigate" button opens Google Maps
- [ ] "Contact Customer" button opens phone dialer
- [ ] Push notifications for new job assignments
- [ ] Offline mode: View today's jobs even without internet

**Technical Implementation:**
- Frontend: React PWA with service workers
- Backend: Extend existing Lambdas with driver endpoints
- Push: OneSignal or Firebase Cloud Messaging
- API: `GET /api/drivers/:driverId/jobs`

**Business Value:**
- Reduces dispatcher workload
- Faster job acceptance
- Real-time status for customers

---

### DRIVER-002: Real-Time GPS Tracking (Customer-Facing)
**Priority:** P3 (MEDIUM)
**Effort:** XL (1-2 months)
**User Story:** As a customer, I want to see my driver's location in real-time so I know when they'll arrive.

**Acceptance Criteria:**
- [ ] Live map on booking details page
- [ ] Driver location updates every 10 seconds
- [ ] ETA displayed: "Arriving in 5 mins"
- [ ] Driver icon moves smoothly on map (animation)
- [ ] Only visible after driver status "En Route"
- [ ] Privacy: Driver location not shared when off-duty

**Technical Implementation:**
- Backend: WebSocket API (AWS API Gateway WebSocket) or polling
- DynamoDB: New `driver-locations` table (TTL 24 hours)
- Driver app: Background location tracking (with consent)
- Frontend: Google Maps API with real-time marker updates

**Business Value:**
- Premium customer experience
- Reduces "Where is my driver?" support calls
- Competitive differentiator vs traditional taxi

---

### COMPLIANCE-001: Driver Document Management Portal
**Priority:** P3 (MEDIUM)
**Effort:** M (1-2 weeks)
**User Story:** As a driver, I need to upload compliance documents so I stay compliant without admin help.

**Acceptance Criteria:**
- [ ] Driver portal page for document uploads
- [ ] Upload: DBS, Insurance, MOT, PHV License, Driving License
- [ ] Photo/PDF upload with preview
- [ ] Expiry date picker
- [ ] Document status: Pending Review, Approved, Expired
- [ ] Email notification 30 days before expiry
- [ ] Admin approval workflow for new uploads

**Technical Implementation:**
- Backend: Extend `uploads-presigned` Lambda
- S3: Driver documents bucket with encryption
- DynamoDB: Link documents to driver records
- Frontend: Upload UI with file validation

**Business Value:**
- Automates compliance tracking
- Reduces admin workload
- Legal liability protection

---

### DISPATCH-001: Automated Driver Assignment Algorithm
**Priority:** P4 (LOW)
**Effort:** XL (1-2 months)
**User Story:** As a dispatcher, I want bookings to auto-assign to the nearest available driver.

**Acceptance Criteria:**
- [ ] When booking confirmed: Auto-assign if driver available
- [ ] Assignment logic: Proximity to pickup (closest first), driver rating (>4.5 stars), vehicle type match
- [ ] Driver can accept/decline (30 second timeout)
- [ ] If declined: Offer to next closest driver
- [ ] Fallback: Manual assignment if no driver accepts
- [ ] Driver push notification with job details

**Technical Implementation:**
- Backend: New Lambda `auto-dispatcher` with proximity calculation
- DynamoDB: Driver availability status, current location
- Algorithm: Haversine formula for distance calculation
- WebSocket: Real-time driver-app communication

**Business Value:**
- Scales beyond manual dispatch
- Faster booking confirmations
- Optimal driver utilization

---

## ðŸ“‹ TECHNICAL DEBT & INFRASTRUCTURE

### TECH-001: Infrastructure as Code (IaC)
**Priority:** P2 (HIGH)
**Effort:** L (3-4 weeks)
**User Story:** As a CTO, I need all infrastructure defined as code so deployments are repeatable and disaster recovery is possible.

**Acceptance Criteria:**
- [ ] All AWS resources defined in Terraform or AWS CDK
- [ ] Separate stacks for: Networking, Database, Compute, Monitoring
- [ ] Environment variables externalized (dev, staging, prod)
- [ ] One-command deploy: `terraform apply -var-file=prod.tfvars`
- [ ] Drift detection: Alert if manual changes made in console
- [ ] Disaster recovery: Can recreate entire stack in new region
- [ ] Documentation: README with setup instructions

**Technical Implementation:**
- Tool: Terraform (more portable) or AWS CDK (better TypeScript integration)
- State: Terraform remote state in S3 with locking (DynamoDB)
- CI/CD: GitHub Actions workflow for terraform plan/apply

**Business Value:**
- Fast disaster recovery
- Consistent environments (no "works on my machine")
- Compliance audit trail
- Enables multi-region expansion

---

### TECH-002: End-to-End Testing Suite
**Priority:** P2 (HIGH)
**Effort:** M (1-2 weeks)
**User Story:** As a CTO, I need automated E2E tests so we can deploy with confidence.

**Acceptance Criteria:**
- [ ] E2E test: Customer quote â†’ booking â†’ payment (happy path)
- [ ] E2E test: Quote expiry handling
- [ ] E2E test: Payment failure â†’ retry â†’ success
- [ ] E2E test: Admin creates booking manually
- [ ] E2E test: Admin assigns driver to booking
- [ ] E2E test: Customer cancels booking â†’ refund
- [ ] Tests run in CI/CD before production deploy
- [ ] Test data cleanup after each run

**Technical Implementation:**
- Tool: Playwright (fast, reliable) or Cypress
- Test environment: Separate test AWS account with Stripe test mode
- CI/CD: Run on every PR merge to main

**Business Value:**
- Prevents regressions
- Faster development (confidence to refactor)
- Investor/stakeholder confidence

---

### TECH-003: Performance Optimization
**Priority:** P3 (MEDIUM)
**Effort:** M (1-2 weeks)
**User Story:** As a CTO, I need the platform to load fast so we don't lose customers to slow UX.

**Acceptance Criteria:**
- [ ] Website Lighthouse score >90 (all categories)
- [ ] Time to Interactive (TTI) <3 seconds on 3G network
- [ ] API p95 latency <200ms
- [ ] Quote calculation <2 seconds (currently ~2-3s)
- [ ] Implement caching: Quote results cached for 5 mins (if same route)
- [ ] Lazy load: Maps library only loads when needed
- [ ] Image optimization: WebP format, responsive sizes
- [ ] Code splitting: Separate bundles for customer/admin flows

**Technical Implementation:**
- Frontend: Next.js dynamic imports, image optimization
- Backend: CloudFront CDN for static assets, API Gateway caching
- Database: DynamoDB DAX for frequently accessed data

**Business Value:**
- Higher conversion rate (faster = more bookings)
- Better SEO ranking
- Lower AWS costs (fewer API calls)

---

## ðŸŽ¯ RECOMMENDED SPRINT PLAN

### Sprint 1 (Next 2 Weeks) - Quote Management Foundation
**Goal:** Admin visibility into quotes and abandonment tracking

- [ ] ADMIN-001: Admin Quote Management Dashboard (M)
- [ ] ADMIN-002: Quote Abandonment Tracking (M)
- [ ] ADMIN-003: Quote-to-Booking Conversion View (S)

**Team Allocation:**
- Backend Engineer: Lambda development, DynamoDB schema
- Frontend Engineer: Admin UI, tables, filters
- QA: Test quote tracking accuracy

---

### Sprint 2-3 (Weeks 3-6) - Production Setup & Security
**Goal:** Production environment ready for Phase 3 launch

- [ ] INFRA-001: Production Environment Setup (M)
- [ ] SECURITY-001: Production Security Hardening (M)
- [ ] TECH-001: Infrastructure as Code (L)

**Team Allocation:**
- DevOps Engineer: AWS infrastructure, CI/CD
- Backend Engineer: Security implementation
- Security Consultant: Penetration testing (external)

---

### Sprint 4-6 (Weeks 7-12) - Phase 3 Core (Revenue Generation)
**Goal:** Customers can pay for bookings, admins can manage them

- [ ] PAYMENT-001: Stripe Payment Integration (L)
- [ ] BOOKING-001: Customer Booking Workflow (L)
- [ ] BOOKING-003: Cancellation & Refund Processing (M)
- [ ] ADMIN-004: Admin Booking Management (L)

**Team Allocation:**
- Full stack engineer: End-to-end booking flow
- Backend engineer: Payment integration, refund logic
- Frontend engineer: Booking UI, admin dashboard

---

### Sprint 7-8 (Weeks 13-16) - Phase 3 Completion
**Goal:** Complete customer communication and booking management

- [ ] NOTIFY-001: Booking Confirmation Emails (M)
- [ ] NOTIFY-002: Booking Confirmation SMS (S)
- [ ] BOOKING-002: View Booking Details (M)
- [ ] ANALYTICS-001: Admin Analytics Dashboard (M)

**Team Allocation:**
- Backend engineer: Notification system
- Frontend engineer: Booking portal, analytics dashboard
- QA: End-to-end testing

---

## ðŸ“Š Success Metrics

**Phase 3 Launch Criteria (Must achieve before go-live):**
- [ ] 100% of user stories marked P0 and P1 are "Done"
- [ ] E2E test coverage >80% for critical paths
- [ ] Lighthouse performance score >85
- [ ] Zero critical security vulnerabilities (penetration test passed)
- [ ] Load testing: Platform handles 100 concurrent users
- [ ] Stripe test mode: Successfully process 20+ test transactions
- [ ] Production environment smoke tests pass

**Post-Launch KPIs (Track weekly):**
- Quote-to-booking conversion rate: Target >15%
- Average booking value: Track baseline, aim for 10% increase in 90 days
- Payment success rate: Target >95%
- Booking cancellation rate: Baseline then optimize
- Customer support tickets: Measure reduction from self-service features
- Platform uptime: Target 99.5%

---

## ðŸš§ Blocked / Pending Decisions

### Decision Required: Payment Gateway
**Question:** Stripe vs PayPal vs GoCardless?
**Recommendation:** Stripe (best developer experience, supports Apple Pay / Google Pay)
**Blocker:** Need business decision on international expansion (PayPal better for non-UK)

### Decision Required: SMS Provider
**Question:** AWS SNS vs Twilio?
**Recommendation:** Start with AWS SNS (cheaper), migrate to Twilio if delivery issues
**Cost:** SNS Â£0.05/SMS, Twilio Â£0.08/SMS (40% more expensive but 99.95% delivery rate)

### Decision Required: Driver App Strategy
**Question:** PWA (web app) vs Native iOS/Android apps?
**Recommendation:** PWA for MVP (faster, single codebase), native apps Phase 4 if needed
**Blocker:** Need to validate if PWA push notifications work reliably on iOS

### Decision Required: Quote Expiry Time
**Question:** Current 15 minutes - too short? Increase to 30/60 mins?
**Data Needed:** Analyze abandonment data after ADMIN-002 implemented
**Recommendation:** A/B test 15min vs 30min after tracking in place

---

## ðŸ“ Notes & Assumptions

**Key Assumptions:**
- Customer payment via Stripe is legally compliant in UK (confirmed with legal)
- No driver onboarding required for Phase 3 (manual dispatch continues)
- Email deliverability >95% (using reputable provider)
- Google Maps API costs stay within budget (<Â£100/month at 1000 bookings/month)

**Risks:**
- Stripe account approval delays (2-7 days typically)
- Payment fraud (mitigate with Stripe Radar)
- SMS delivery failures in rural Dorset (test coverage with real customers)
- GDPR compliance gaps (audit before launch)

**Dependencies:**
- Frontend framework: Next.js 14 (current)
- Backend runtime: Node.js 20 on Lambda (current)
- Database: DynamoDB (no migration planned)
- Deployment: Vercel (frontend) + AWS Lambda (backend)

---

**Document Status:** Living document - Updated after each sprint planning
**Last Review:** Current sprint
**Next Review:** End of Sprint 1 (after quote management features deployed)
**Approvers:** CTO âœ… | CPO (Pending) | CEO (For Phase 3 budget approval)

---

*This backlog represents the strategic path from Phase 2 completion to Phase 3 revenue generation and beyond. Priorities may shift based on customer feedback and business needs.*
